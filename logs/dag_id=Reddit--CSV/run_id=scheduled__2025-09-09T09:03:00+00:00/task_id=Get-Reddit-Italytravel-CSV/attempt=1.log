{"timestamp":"2025-09-09T09:04:37.622210","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-09-09T09:04:37.623206","level":"info","event":"Filling up the DagBag from /home/tahmast/airflow/dags/Reddit_Italytravel_To_Csv.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-09-09T09:04:37.966384","level":"info","event":"Tmp dir root location: /tmp","logger":"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook"}
{"timestamp":"2025-09-09T09:04:37.966965","level":"info","event":"Running command: ['/usr/bin/bash', '-c', '\\nset -Eeuo pipefail\\n\\nOUTDIR=\"/home/tahmast/airflow/data\"\\nmkdir -p \"$OUTDIR\"\\nOUT=\"$OUTDIR/$(date +%s).csv\"\\nURL=\\'https://www.reddit.com/r/italytravel/new.json?limit=10&raw_json=1\\'\\nUA=\\'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125 Safari/537.36\\'\\n\\nTMP=$(mktemp)\\n\\n# 1) بگیر و کُد وضعیت رو چک کن\\ncode=$(curl -sS --compressed -A \"$UA\" -w \\'%{http_code}\\' -o \"$TMP\" \"$URL\" || echo \"000\")\\nif [ \"$code\" != \"200\" ]; then\\n  echo \"ERROR: HTTP $code\" >&2\\n  head -c 500 \"$TMP\" || true\\n  exit 1\\nfi\\n\\n# 2) هدر CSV\\nprintf \\'id,author,title,score,num_comments,created_at,permalink\\\\n\\' > \"$OUT\"\\n\\n# 3) تبدیل JSON → CSV\\njq -re \\'\\n  .data.children[].data\\n  | [\\n      .id,\\n      .author,\\n      (.title | gsub(\"\\\\\\\\s+\";\" \") | .[0:500]),\\n      .score,\\n      .num_comments,\\n      (.created_utc | gmtime | strftime(\"%Y-%m-%dT%H:%M:%SZ\")),\\n      (\"https://www.reddit.com\"+.permalink)\\n    ] | @csv\\n\\' \"$TMP\" >> \"$OUT\"\\n\\n# 4) حداقل یک ردیف داده داشته باش\\nrows=$(wc -l < \"$OUT\")\\nif [ \"$rows\" -le 1 ]; then\\n  echo \"ERROR: no rows parsed\" >&2\\n  head -c 500 \"$TMP\" || true\\n  exit 1\\nfi\\n\\necho \"Wrote: $OUT\"\\nrm -f \"$TMP\"']","logger":"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook"}
{"timestamp":"2025-09-09T09:04:37.978344","level":"info","event":"Output:","logger":"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook"}
{"timestamp":"2025-09-09T09:04:39.552778","level":"info","event":"Wrote: /home/tahmast/airflow/data/1757408677.csv","logger":"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook"}
{"timestamp":"2025-09-09T09:04:39.555533","level":"info","event":"Command exited with return code 0","logger":"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook"}
{"timestamp":"2025-09-09T09:04:39.557017","level":"info","event":"Pushing xcom","ti":"RuntimeTaskInstance(id=UUID('01992db8-0d22-7120-98a0-c97a5a369c49'), task_id='Get-Reddit-Italytravel-CSV', dag_id='Reddit--CSV', run_id='scheduled__2025-09-09T09:03:00+00:00', try_number=1, map_index=-1, hostname='tahmast-HP-ProBook-450-G0', context_carrier=None, task=<Task(BashOperator): Get-Reddit-Italytravel-CSV>, bundle_instance=LocalDagBundle(name=dags-folder), max_tries=0, start_date=datetime.datetime(2025, 9, 9, 9, 4, 22, 266003, tzinfo=datetime.timezone.utc), end_date=None, state=<TaskInstanceState.RUNNING: 'running'>, is_mapped=False, rendered_map_index=None, log_url='http://localhost:8080/dags/Reddit--CSV/runs/scheduled__2025-09-09T09%3A03%3A00%2B00%3A00/tasks/Get-Reddit-Italytravel-CSV?try_number=1')","logger":"task"}
